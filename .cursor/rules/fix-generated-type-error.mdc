# Fix Generated Type Errors

This guide helps resolve TypeScript type definition errors that occur during GIR type generation.

## Quick Fix Workflow

1. **Identify the error** from CLI output or TypeScript compiler
2. **Locate the problematic type** in generated files or GIR source
3. **Apply targeted fixes** using overrides or template modifications
4. **Regenerate types** to verify the fix
5. **Test the result** with TypeScript compilation

## Common Error Types

### Type Resolution Failures
- **Unresolved type references**: Missing or incorrect type imports
- **Circular dependencies**: Self-referencing type definitions
- **Missing GIR definitions**: Incomplete GIR file coverage

### Generation Errors
- **Template syntax issues**: Invalid EJS template code
- **Type mapping problems**: Incorrect GIR to TypeScript conversions
- **Validation failures**: Type constraint violations

### Parsing Issues
- **GIR XML errors**: Malformed or incomplete GIR files
- **Schema violations**: GIR content doesn't match expected format
- **Encoding problems**: Character encoding issues in GIR files

## Fix Strategies

### 1. Override Problematic Types
Use type overrides in your configuration to fix specific issues:

```javascript
// .ts-for-gir.rc.js
export default {
  overrides: {
    'Gtk.Widget': {
      'get_allocated_width': {
        returnType: 'number',
        doc: 'Override for problematic return type'
      }
    }
  }
};
```

### 2. Template Modifications
Customize templates to handle edge cases:

```ejs
<% if (type === 'gpointer' && isOptional) { %>
  any | null
<% } else if (type === 'gpointer') { %>
  any
<% } else { %>
  <%= type %>
<% } %>
```

### 3. GIR Source Fixes
Update GIR files to correct source issues:

```xml
<!-- Fix incorrect type reference -->
<parameter name="data" transfer-ownership="none">
  <type name="gpointer" c:type="gpointer"/>
</parameter>
```

## Debugging Process

### Step 1: Enable Detailed Reporting
```bash
yarn ts-for-gir-dev generate --reporter --verbose
```

### Step 2: Analyze Error Patterns
```bash
yarn ts-for-gir-dev analyze -f ./ts-for-gir-report.json
```

### Step 3: Focus on Specific Issues
```bash
# Show only critical errors
yarn ts-for-gir-dev analyze -f ./report.json --severity critical

# Focus on type resolution issues
yarn ts-for-gir-dev analyze -f ./report.json --category type_resolution
```

## Advanced Fixes

### Custom Type Mappers
Implement custom type conversion logic:

```javascript
// .ts-for-gir.rc.js
export default {
  typeMappers: {
    'gpointer': 'any',
    'gconstpointer': 'any',
    'gchar*': 'string | null'
  }
};
```

### Namespace Overrides
Fix entire namespace issues:

```javascript
export default {
  namespaceOverrides: {
    'Gtk': {
      ignore: ['DeprecatedWidget'],
      prefix: 'Gtk'
    }
  }
};
```

## Validation and Testing

### TypeScript Compilation
```bash
# Check generated types compile correctly
tsc --noEmit --project ./types/tsconfig.json
```

### Runtime Testing
```bash
# Test with actual GJS code
gjs test-script.js
```

## Prevention Strategies

1. **Regular validation** of generated types
2. **Template testing** with sample GIR data
3. **Override documentation** for complex fixes
4. **Regression testing** after template changes

## Resources

**For comprehensive CLI usage, filtering options, and command examples, see [cli-usage](mdc:.cursor/rules/cli-usage.mdc).**

Key error analysis workflow:
1. **Generate with reporter**: `yarn ts-for-gir-dev generate --reporter`
2. **Analyze reports**: `yarn ts-for-gir-dev analyze -f ./ts-for-gir-report.json`
3. **Apply targeted filters**: Use severity, category, and search filters as documented in cli-usage

## Diagnostic Workflow

### Error Classification
- **Critical**: Prevents type generation
- **Error**: Causes compilation failures
- **Warning**: Potential runtime issues
- **Info**: Informational messages

### Resolution Priority
1. Fix critical errors first
2. Address compilation-blocking issues
3. Resolve warnings for production quality
4. Review info messages for optimization

### Testing Strategy
- **Unit tests** for individual type fixes
- **Integration tests** for complete modules
- **Regression tests** after template changes
- **Performance tests** for large type sets

**During**: Minimal targeted changes, incremental testing with reporter validation, maintain compatibility  
**After**: All checks pass, reporter shows issue resolution, original error resolved, no regressions

Use GIR XML files in `girs/` to validate that generated TypeScript definitions accurately represent the original GObject introspection data structure and bindings. Leverage the reporter system for systematic problem identification and resolution tracking.
